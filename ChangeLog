2003-05-12  root  <root@gills.dancysoft.com>

	* aliases.cl:  Only allow one :error: thing on a right hand side
	of an alias.

	* bounce.cl:  Change the name of the bounce function to 'bounce'.
	Added stuff so that bounces are sent to their proper owners.  Also
	added an additional keyword argument to the bounce function so
	that undeliverable recipients (due to timeout) will have a
	sentence indicating so.

	* config.cl:  Moved the aliases lookup in front of the passwd
	lookup in the *local-recip-checks* parameter.  

	* deliver-smtp.cl:  Uses new recip struct. 

	* emailaddr.cl:  Make sure that the emailaddr-orig for <> is "<>".

	* queue-process.cl:  queue-process-single-help uses the new recip
	struct now.  The function is a smidge simpler now.

	* recips.cl:  Added a 'status' slot to the recip struct.  
	lookup-recip-in-passwd now returns a recip struct.

	get-content-disposition modified since the lookup-recip-in-*
	functions return recip structs now.  expand-recips is now
	expand-addresses.  
	

2003-05-09  root  <root@gills.dancysoft.com>

	* emailaddr.cl:  In parse-email-addr-list.  If cruft is all
	whitespace, then convert it to "".  Also, emailaddr-orig is now
	set to just the user@domain string.  No comments or other stuff is
	included.  

	* headers.cl:  Fixed bug in make-from-header when 'from' is <>.  

	* input.cl:  New function:  grab-recips-from-headers for use w/
	the -t flag.  send-from-stdin now uses this function if it is
	called w/ grab-recips keyword argument.  

	* maild.cl:  Added -t support.

	* queue-process.cl:  Delivery failure messages for a particular
	queue item are collected and sent in a single bounce message now.

	* queue.cl:  make-queue-file doesn't take the recips list now.
	That is saved for the new queue-finalize function (which is mostly
	queue-init-headers renamed).   Updated the with-new-queue macro
	for this as well.

	* several places:  Changes due to the changes in queue.cl.

2003-05-08  root  <root@dancy>

	* aliases.cl:  Aliases file must be owned by root and have safe
	permissions.

	* deliver.cl:  Delivery programs (aliases and defined local
	delivery program) must be owned by root and have safe
	permissions.  I may relax this if it turns out to be too
	restrictive.

	* headers.cl:  Received header now includes the original envelope
	recipients per Charley's request.  Note that this makes Bcc:
	ineffective (in terms of blindness).

	* lock.cl:  Generalized with-lock-file-nowait to with-lock-file
	and a keyword arg.

	* maild.cl:  /etc/maild/cl must be owned by root and have safe
	permissions.  Same w/ *queuedir*.

	* queue.cl:  Queue files are generated in a different way now.
	Simpler.

	* recips.cl:  Moved some of the recipient alias expansion stuff
	out of queue.cl and into this file.   Fixed a bug w/ "user:
	user@localdomain" type expansion.

2003-04-30  root  <root@gills.dancysoft.com>

	* Makefile:  Make maild/maild depend on *.cl

	* bounce.cl: Use new with-new-queue macro.

	* deliver.cl:  Add verbosity to deliver-local function.  In
	send-message-to-program, return stderr along w/ the :transient
	error code if the delivery program exited w/ non-zero
	status... and do the same for the error condition from the message
	stream writer.

	* input.cl:  Had a call to string-downcase in the wrong place.
	Moved.    Updated send-from-stdin.  read-message-stream now calls
	finish-output and fsync on the datafile on behalf of the caller.

	* queue.cl:  Updated with-new-queue macro.

	* smtp-server.cl:  Updated to use with-new-queue macro.  

2003-04-30  root  <root@dancy>

	* deliver.cl:  write-message-to-stream:  headers that spanned
	lines weren't being written out w/ the proper EOL convention.
	Fixed.  

	* queue-process.cl: Rearranged some code in the queue processing
	function for better status reporting.    Minor changes to the
	queue lister.  Added a queue processing daemon.

	* queue.cl:  Added new 'valid' slot to the queue struct.  It is
	used by the new with-new-queue macro.  If the slot is still nil
	when the macro completes, the queue file will be deleted.  This
	effects cleanup for interrupted message transmissions, etc.

	* security.cl:  verify-root: new function to check that the real
	user is root.
	
	* input.cl: send-from-stdin:  Try out new with-new-queue macro.

	* maild.cl: main:  Implemented more of the command line args.  Can
	run in daemon mode now w/ optional periodic queue processing.
	Signal handlers added for SIGINT and SIGTERM for clean shutdown.
	Security checks on queue-manipulating commands.  

	* smtp-server.cl:  New smtp-server-daemon function.

2003-04-28  root  <root@dancy>

	* config.cl: Added *smtp-ip* parameter for binding the server
	socket to a particular interface.

	* smtp-server.cl:  Use the new *smtp-ip* parameter

	* deliver-smtp.cl:  Added :verbose keyword arg to many of the
	functions so that the SMTP transaction can be watched (ala
	sendmail -v).   Also added a with-socket-timeout around the main
	function so that an unresponsive SMTP server doesn't make us hang.

	* deliver.cl:  New write-message-to-stream-async for use with
	send-message-to-program.  It is intended to be called via
	mp:process-run-function.  It takes a structure which has the usual
	arguments to write-message-to-stream.. plus a gate and a status
	field for returning information to the caller.

	* queue-process.cl:  Added :verbose keyword stuff.  Also, the
	queue processor now collects the error messages from the delivery
	subroutines for storage in the queue file.  

2003-04-24  root  <root@dancy>

	* config.cl:  Call local delivery program w/ -f.
	Added comments to the timeouts section.

	* sockets are now hiper sockets so that I can use read and write
	timeouts w/ ease.

	


